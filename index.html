<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>GrowBox Pro v5.1 (–ë–µ–∑ Firebase)</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        /* ‚Äî‚Äî‚Äî –í–°–ï –°–¢–ò–õ–ò –ë–ï–ó –ò–ó–ú–ï–ù–ï–ù–ò–ô ‚Äî‚Äî‚Äî */
        :root {
            --color-primary: #2e7d32;
            --color-primary-light: #4caf50;
            --color-primary-dark: #1b5e20;
            --color-bg-light: #f1f8e9;
            --color-bg-white: #ffffff;
            --color-bg-card: rgba(255, 255, 255, 0.9); 
            --color-bg-nav: rgba(255, 255, 255, 0.7);
            --color-text: #1b5e20;
            --color-text-secondary: #558b2f;
            --color-success: #4caf50;
            --color-error: #f44336;
            --color-warning: #ff9800;
            --color-info: #2196f3;
            --color-border: rgba(46, 125, 50, 0.2);
            --color-shadow: rgba(46, 125, 50, 0.1); 
            --color-gold: #ffd700;
            --spacing-xs: 4px;
            --spacing-sm: 8px;
            --spacing-md: 16px;
            --spacing-lg: 24px;
            --radius-sm: 8px;
            --radius-md: 12px;
            --radius-lg: 20px;
            --transition: 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
        }
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            color: var(--color-text);
            overflow-x: hidden;
            padding-top: 100px;  
            padding-bottom: 80px;
            min-height: 100vh;
            position: relative;
            background: linear-gradient(-45deg, #e8f5e9, #f1f8e9, #c8e6c9, #a5d6a7);
            background-size: 400% 400%;
            animation: gradientBG 15s ease infinite;
        }
        @keyframes gradientBG {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        .glass-ui {
            background: var(--color-bg-nav);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 8px 32px 0 var(--color-shadow);
        }
        .header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            padding: var(--spacing-sm) var(--spacing-md);
            z-index: 100;
            height: 100px;
            border-bottom: 1px solid var(--color-border);
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }
        .header-top {
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: 100%;
        }
        .header-title {
            font-size: 16px;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
        }
        .header-title-logo {
            font-size: 28px;
        }
        .header-stats {
            display: flex;
            gap: var(--spacing-sm);
            font-size: 14px;
            font-weight: 600;
        }
        .stat-item {
            display: flex;
            align-items: center;
            gap: 4px;
            background: var(--color-bg-card);
            padding: var(--spacing-xs) var(--spacing-sm);
            border-radius: var(--radius-lg);
            box-shadow: 0 2px 4px var(--color-shadow);
        }
        .stat-item span:first-child {
            font-size: 18px;
        }
        .equipment-bonus-icons {
            display: flex;
            gap: var(--spacing-xs);
        }
        .equipment-bonus-icons span {
            font-size: 12px;
            padding: 4px;
            background: rgba(255,215,0,0.3);
            border-radius: 50%;
            display: none;
        }
        .xp-bar-container {
            width: 100%;
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
            padding-bottom: var(--spacing-xs);
        }
        .level-badge {
            font-size: 12px;
            font-weight: 700;
            background: linear-gradient(135deg, var(--color-primary-light), var(--color-primary));
            color: white;
            padding: 4px 8px;
            border-radius: var(--radius-sm);
            box-shadow: 0 2px 4px var(--color-shadow);
        }
        .xp-bar {
            flex: 1;
            height: 12px;
            background: var(--color-border);
            border-radius: 6px;
            overflow: hidden;
            position: relative;
        }
        .xp-bar-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--color-gold), var(--color-warning));
            width: 0%;
            transition: width 0.5s var(--transition);
        }
        .xp-bar-text {
            position: absolute;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
            font-size: 9px;
            font-weight: 700;
            color: var(--color-primary-dark);
            text-shadow: 0 1px 1px rgba(255,255,255,0.4);
        }
        .container {
            max-width: 480px;
            margin: 0 auto;
            padding: var(--spacing-md);
            position: relative;
            z-index: 2;
        }
        .stars {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            pointer-events: none;
            z-index: -1;
            display: none;
            opacity: 0;
            transition: opacity 1s ease;
        }
        .star {
            position: absolute;
            width: 2px; height: 2px;
            background: white;
            border-radius: 50%;
            animation: twinkle 2s ease-in-out infinite;
        }
        @keyframes twinkle {
            0%, 100% { opacity: 0.3; }
            50% { opacity: 1; }
        }
        .loading-overlay {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background: var(--color-bg-light);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            transition: opacity 0.5s ease;
        }
        .spinner {
            border: 4px solid var(--color-border);
            border-top: 4px solid var(--color-primary);
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
        }
        .spinner-container {
            display: flex;
            justify-content: center;
            align-items: center;
            padding: var(--spacing-lg);
            min-height: 200px;
        }
        .spinner-container .spinner {
             width: 30px;
             height: 30px;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        .loading-text {
            margin-top: var(--spacing-md);
            font-weight: 600;
            color: var(--color-primary);
        }
        .advice-box {
            background: var(--color-bg-card);
            backdrop-filter: blur(5px);
            border-left: 4px solid var(--color-primary);
            padding: var(--spacing-md);
            border-radius: var(--radius-md);
            margin-bottom: var(--spacing-md);
            font-size: 14px;
            line-height: 1.5;
            box-shadow: 0 4px 12px var(--color-shadow);
            transition: border-color var(--transition);
        }
        .garden-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: var(--spacing-md);
            margin-bottom: var(--spacing-md);
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .plant-card {
            background: var(--color-bg-card);
            backdrop-filter: blur(5px);
            border: 1px solid var(--color-border);
            border-radius: var(--radius-lg);
            padding: var(--spacing-md);
            box-shadow: 0 8px 24px var(--color-shadow);
            cursor: pointer;
            transition: all var(--transition);
            position: relative;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            min-height: 240px;
            animation: fadeIn 0.5s var(--transition);
        }
        .plant-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 32px rgba(46, 125, 50, 0.2);
            border-color: var(--color-primary);
        }
        .plant-card.empty {
            border: 2px dashed var(--color-border);
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 240px;
            background: rgba(255, 255, 255, 0.5);
            backdrop-filter: blur(2px);
        }
        .plant-card.empty:hover {
            background: rgba(255, 255, 255, 0.7);
        }
        .plant-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--spacing-sm);
        }
        .plant-name {
            font-weight: 700;
            color: var(--color-primary);
            font-size: 14px;
        }
        .plant-stage {
            font-size: 12px;
            color: var(--color-text-secondary);
        }
        .plant-image-container {
            width: 100%;
            height: 100px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: var(--spacing-sm) 0;
        }
        .plant-image {
            max-width: 100%;
            max-height: 100px;
            object-fit: contain;
            transition: transform 0.5s ease;
        }
        .plant-card.harvestable {
            animation: pulseHarvest 1.5s infinite;
        }
        .plant-card.sick {
            animation: pulseDisease 2s infinite;
        }
        @keyframes pulseHarvest {
            0% { box-shadow: 0 8px 24px var(--color-shadow); border-color: var(--color-border); }
            50% { box-shadow: 0 10px 30px rgba(255, 215, 0, 0.5); border-color: var(--color-gold); }
            100% { box-shadow: 0 8px 24px var(--color-shadow); border-color: var(--color-border); }
        }
        @keyframes pulseDisease {
            0% { border-color: var(--color-border); }
            50% { border-color: var(--color-error); }
            100% { border-color: var(--color-border); }
        }
        .disease-badge {
            position: absolute;
            top: 10px;
            right: 10px;
            background: var(--color-error);
            color: white;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 10px;
            font-weight: 700;
            animation: shake 0.5s ease-in-out infinite;
        }
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-3px); }
            75% { transform: translateX(3px); }
        }
        .plant-stats {
            display: flex;
            flex-direction: column;
            gap: 6px;
            margin-top: var(--spacing-sm);
        }
        .stat-bar {
            display: flex;
            align-items: center;
            gap: var(--spacing-xs);
            font-size: 12px;
            font-weight: 600;
        }
        .stat-icon {
            font-size: 14px;
            width: 18px;
            text-align: center;
        }
        .progress-bar {
            flex: 1;
            height: 10px;
            background: var(--color-border);
            border-radius: 5px;
            overflow: hidden;
        }
        .progress-fill {
            height: 100%;
            transition: width var(--transition);
        }
        #healthFill { background: var(--color-success); }
        #waterFill { background: var(--color-info); }
        #growthFill { background: var(--color-warning); }
        .soil-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: var(--spacing-xs);
            margin-top: var(--spacing-sm);
            padding-top: var(--spacing-sm);
            border-top: 1px solid var(--color-border);
        }
        .soil-stat {
            text-align: center;
            font-size: 10px;
            color: var(--color-text-secondary);
        }
        .soil-stat-label { 
            font-weight: 700; 
            color: var(--color-text); 
        }
        .plant-actions {
            margin-top: var(--spacing-md);
        }
        .action-btn {
            width: 100%;
            padding: 10px;
            border: none;
            border-radius: var(--radius-sm);
            background: linear-gradient(135deg, var(--color-primary-light), var(--color-primary));
            color: white;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all var(--transition);
            box-shadow: 0 2px 4px var(--color-shadow);
        }
        .action-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(46, 125, 50, 0.3);
        }
        .action-btn.harvest {
            background: linear-gradient(135deg, var(--color-gold), var(--color-warning));
            color: var(--color-primary-dark);
        }
        .action-btn.harvest:hover {
            box-shadow: 0 4px 12px rgba(255, 215, 0, 0.4);
        }
        .section-title {
            font-size: 20px;
            font-weight: 700;
            color: var(--color-primary-dark);
            margin-bottom: var(--spacing-md);
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
        }
        .section-title span {
            font-size: 24px;
        }
        .item-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: var(--spacing-md);
        }
        .item-card {
            background: var(--color-bg-card);
            backdrop-filter: blur(5px);
            border-radius: var(--radius-lg);
            padding: var(--spacing-md);
            box-shadow: 0 8px 24px var(--color-shadow);
            text-align: center;
            transition: all var(--transition);
            border: 1px solid var(--color-border);
        }
        .item-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 32px rgba(46, 125, 50, 0.2);
            border-color: var(--color-primary);
        }
        .item-icon {
            font-size: 48px;
            margin-bottom: var(--spacing-sm);
            line-height: 1;
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .item-name {
            font-weight: 700;
            color: var(--color-primary);
            margin-bottom: var(--spacing-xs);
            font-size: 14px;
        }
        .item-description {
            font-size: 11px;
            color: var(--color-text-secondary);
            margin-bottom: var(--spacing-sm);
            min-height: 22px;
        }
        .item-price {
            font-weight: 700;
            color: var(--color-primary-dark);
            font-size: 14px;
            margin-bottom: var(--spacing-md);
        }
        .buy-btn {
            width: 100%;
            padding: 10px;
            border: none;
            border-radius: var(--radius-sm);
            background: linear-gradient(135deg, var(--color-primary-light), var(--color-primary));
            color: white;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all var(--transition);
            box-shadow: 0 2px 4px var(--color-shadow);
        }
        .buy-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 8px rgba(46, 125, 50, 0.3);
        }
        .buy-btn:disabled {
            background: #aaa;
            opacity: 0.7;
            cursor: not-allowed;
        }
        .inventory-card {
            position: relative;
        }
        .inventory-count {
            position: absolute;
            top: 8px;
            right: 8px;
            background: var(--color-primary);
            color: white;
            font-size: 12px;
            font-weight: 700;
            padding: 2px 8px;
            border-radius: 10px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }
        .inventory-name {
            font-weight: 700;
            color: var(--color-primary);
            margin-bottom: var(--spacing-sm);
            font-size: 14px;
        }
        .product-card {
            background: var(--color-bg-white);
            border-radius: var(--radius-lg);
            overflow: hidden;
            box-shadow: 0 8px 24px var(--color-shadow);
            margin-bottom: var(--spacing-md);
            transition: all var(--transition);
            border: 1px solid var(--color-border);
        }
        .product-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 32px rgba(46, 125, 50, 0.2);
        }
        .product-image {
            width: 100%;
            height: 160px;
            object-fit: cover;
            background: var(--color-bg-light);
        }
        .product-content {
            padding: var(--spacing-md);
        }
        .product-name {
            font-size: 16px;
            font-weight: 700;
            color: var(--color-primary);
            margin-bottom: var(--spacing-xs);
        }
        .product-description {
            font-size: 12px;
            color: var(--color-text-secondary);
            margin-bottom: var(--spacing-md);
            line-height: 1.5;
        }
        .product-price {
            font-size: 18px;
            font-weight: 700;
            color: var(--color-primary-dark);
            margin-bottom: var(--spacing-md);
        }
        .product-link {
            display: block;
            width: 100%;
            padding: 12px;
            background: linear-gradient(135deg, var(--color-primary-light), var(--color-primary));
            color: white;
            text-align: center;
            text-decoration: none;
            border-radius: var(--radius-sm);
            font-weight: 600;
            transition: all var(--transition);
        }
        .product-link:hover {
            transform: scale(1.02);
            box-shadow: 0 4px 8px rgba(46, 125, 50, 0.3);
        }
        .reward-card {
            background: linear-gradient(135deg, #fff9c4, #fffde7);
            border: 2px solid var(--color-gold);
            border-radius: var(--radius-lg);
            padding: var(--spacing-md);
            box-shadow: 0 8px 24px rgba(255, 215, 0, 0.2);
            margin-bottom: var(--spacing-md);
        }
        .reward-title {
            font-size: 16px;
            font-weight: 700;
            color: var(--color-primary-dark);
            margin-bottom: var(--spacing-xs);
        }
        .reward-description {
            font-size: 12px;
            color: #b08d57;
            margin-bottom: var(--spacing-md);
        }
        .reward-cost {
            font-weight: 700;
            color: var(--color-primary-dark);
            font-size: 14px;
            margin-bottom: var(--spacing-md);
        }
        .redeem-btn {
            width: 100%;
            padding: 12px;
            border: none;
            border-radius: var(--radius-sm);
            background: linear-gradient(135deg, #ffd700, #ffc107);
            color: var(--color-primary-dark);
            font-size: 14px;
            font-weight: 700;
            cursor: pointer;
            transition: all var(--transition);
        }
        .redeem-btn:disabled {
            background: #ccc;
            color: #777;
            cursor: not-allowed;
        }
        .settings-group {
            background: var(--color-bg-card);
            backdrop-filter: blur(5px);
            border-radius: var(--radius-lg);
            padding: var(--spacing-md);
            margin-bottom: var(--spacing-md);
            box-shadow: 0 4px 12px var(--color-shadow);
        }
        .settings-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--spacing-md);
        }
        .settings-item:last-child { margin-bottom: 0; }
        .settings-label {
            font-weight: 600;
            color: var(--color-primary);
        }
        .toggle-switch {
            position: relative;
            width: 50px;
            height: 28px;
            background: var(--color-border);
            border-radius: 14px;
            cursor: pointer;
            transition: background var(--transition);
        }
        .toggle-switch.active {
            background: var(--color-primary);
        }
        .toggle-slider {
            position: absolute;
            top: 2px;
            left: 2px;
            width: 24px;
            height: 24px;
            background: white;
            border-radius: 50%;
            transition: transform var(--transition);
        }
        .toggle-switch.active .toggle-slider {
            transform: translateX(22px);
        }
        .user-id-box {
            font-size: 12px;
            color: var(--color-text-secondary);
            background: var(--color-bg-light);
            padding: var(--spacing-sm);
            border-radius: var(--radius-sm);
            word-break: break-all;
        }
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            height: 80px;
            padding: var(--spacing-sm) 0;
            z-index: 100;
            display: flex;
            justify-content: space-around;
            border-top: 1px solid var(--color-border);
        }
        .nav-item {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 4px;
            padding: var(--spacing-xs);
            cursor: pointer;
            transition: all var(--transition);
            border: none;
            background: transparent;
            color: var(--color-text-secondary);
        }
        .nav-item:hover {
            transform: translateY(-3px);
        }
        .nav-item.active {
            color: var(--color-primary);
            transform: scale(1.1);
        }
        .nav-icon { font-size: 24px; }
        .nav-label { font-size: 10px; font-weight: 600; }
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 3000;
            padding: var(--spacing-md);
            backdrop-filter: blur(5px);
        }
        .modal.show {
            display: flex;
        }
        .modal-content {
            background: white;
            border-radius: var(--radius-lg);
            padding: var(--spacing-lg);
            max-width: 400px;
            width: 100%;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            animation: slideInUp 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
        }
        @keyframes slideInUp {
            from { transform: translateY(50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--spacing-md);
        }
        .modal-title {
            font-size: 20px;
            font-weight: 700;
            color: var(--color-primary);
        }
        .modal-close {
            background: none;
            border: none;
            font-size: 28px;
            cursor: pointer;
            color: var(--color-text-secondary);
        }
        .modal-body { margin-bottom: var(--spacing-md); }
        .modal-actions {
            display: flex;
            gap: var(--spacing-sm);
        }
        .modal-btn {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: var(--radius-sm);
            font-weight: 600;
            cursor: pointer;
            transition: all var(--transition);
        }
        .modal-btn.primary {
            background: linear-gradient(135deg, var(--color-primary-light), var(--color-primary));
            color: white;
        }
        .modal-btn.secondary {
            background: var(--color-bg-light);
            color: var(--color-text);
        }
        .toast {
            position: fixed;
            top: 110px;
            left: 50%;
            transform: translateX(-50%);
            background: var(--color-primary-dark);
            color: white;
            padding: var(--spacing-md) var(--spacing-lg);
            border-radius: var(--radius-md);
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            z-index: 2000;
            animation: slideDown 0.3s ease-out;
            max-width: 90%;
            font-size: 14px;
            font-weight: 600;
        }
        .toast.success { background: var(--color-success); }
        .toast.error { background: var(--color-error); }
        .toast.info { background: var(--color-info); }
        @keyframes slideDown {
            from { transform: translateX(-50%) translateY(-50px); opacity: 0; }
            to { transform: translateX(-50%) translateY(0); opacity: 1; }
        }
        .draggable {
            cursor: grab;
            user-select: none;
        }
        .dragging {
            opacity: 0.5;
            transform: scale(1.1) rotate(5deg);
            cursor: grabbing;
            box-shadow: 0 10px 20px rgba(0,0,0,0.3);
            z-index: 5000;
        }
        .droppable-hover {
            outline: 3px dashed var(--color-gold);
            outline-offset: 4px;
            transform: scale(1.02);
            border-color: var(--color-gold);
        }
        .hidden { display: none !important; }
    </style>
</head>
<body>
    <div class="stars" id="stars"></div>
    <div class="loading-overlay" id="loadingOverlay">
        <div class="spinner"></div>
        <div class="loading-text">–ó–∞–≥—Ä—É–∑–∫–∞ –∏–≥—Ä—ã...</div>
    </div>
    <div class="header glass-ui">
        <div class="header-top">
            <div class="header-title">
                <span class="header-title-logo">üå±</span>
                <span>GrowBox Pro</span>
            </div>
            <div class="header-stats">
                <div class="equipment-bonus-icons">
                    <span id="bonus-led">üí°</span>
                    <span id="bonus-ventilation">üåÄ</span>
                    <span id="bonus-autowater">üíß</span>
                </div>
                <div class="stat-item">
                    <span>üí∞</span>
                    <span id="moneyDisplay">0</span>
                </div>
                <div class="stat-item">
                    <span>üíé</span>
                    <span id="shopPointsDisplay">0</span>
                </div>
            </div>
        </div>
        <div class="xp-bar-container">
            <div class="level-badge">LVL <span id="levelDisplay">1</span></div>
            <div class="xp-bar">
                <div class="xp-bar-fill" id="xpBarFill"></div>
                <span class="xp-bar-text" id="xpBarText">0 / 100</span>
            </div>
        </div>
    </div>
    <div class="container">
        <div id="gardenView" class="view">
            <div class="advice-box" id="adviceBox">
                üí° –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å! –ü–æ—Å–∞–¥–∏—Ç–µ –≤–∞—à–µ –ø–µ—Ä–≤–æ–µ —Ä–∞—Å—Ç–µ–Ω–∏–µ.
            </div>
            <div class="garden-grid" id="gardenGrid"></div>
        </div>
        <div id="shopView" class="view hidden">
            <h2 class="section-title"><span>üè™</span> –ú–∞–≥–∞–∑–∏–Ω</h2>
            <h3 style="margin: var(--spacing-md) 0; color: var(--color-primary);">üå± –°–µ–º–µ–Ω–∞</h3>
            <div class="item-grid" id="seedsShop"></div>
            <h3 style="margin: var(--spacing-lg) 0 var(--spacing-md); color: var(--color-primary);">üß™ –†–∞—Å—Ö–æ–¥–Ω–∏–∫–∏</h3>
            <div class="item-grid" id="consumablesShop"></div>
            <h3 style="margin: var(--spacing-lg) 0 var(--spacing-md); color: var(--color-primary);">‚öôÔ∏è –û–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ</h3>
            <div class="item-grid" id="equipmentShop"></div>
        </div>
        <div id="inventoryView" class="view hidden">
            <h2 class="section-title"><span>üéí</span> –ò–Ω–≤–µ–Ω—Ç–∞—Ä—å</h2>
            <p style="font-size: 13px; color: var(--color-text-secondary); margin-bottom: var(--spacing-md);">
                –ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ –ø—Ä–µ–¥–º–µ—Ç –∏–∑ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—è –Ω–∞ —Ä–∞—Å—Ç–µ–Ω–∏–µ, —á—Ç–æ–±—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –µ–≥–æ.
            </p>
            <div class="item-grid" id="inventoryGrid"></div>
        </div>
        <div id="realShopView" class="view hidden">
            <h2 class="section-title"><span>üè¨</span> –†–µ–∞–ª—å–Ω—ã–π –º–∞–≥–∞–∑–∏–Ω</h2>
            <p style="font-size: 13px; color: var(--color-text-secondary); margin-bottom: var(--spacing-md);">
                –ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–æ–µ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ –¥–ª—è –≤–∞—à–∏—Ö —Ä–µ–∞–ª—å–Ω—ã—Ö –ø—Ä–æ–µ–∫—Ç–æ–≤.
            </p>
            <div id="realProductsGrid">
                <div class="product-card">
                    <img src="https://placehold.co/400x300/e8f5e9/1b5e20?text=üí°" class="product-image">
                    <div class="product-content">
                        <h3 class="product-name">LED –§–∏—Ç–æ–ª–∞–º–ø–∞ Mars Hydro TS 1000</h3>
                        <p class="product-description">–ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–∞—è LED –ª–∞–º–ø–∞ –ø–æ–ª–Ω–æ–≥–æ —Å–ø–µ–∫—Ç—Ä–∞.</p>
                        <div class="product-price">15 990 ‚ÇΩ</div>
                        <a href="https://example.com" target="_blank" class="product-link">üõí –°–º–æ—Ç—Ä–µ—Ç—å –≤ –º–∞–≥–∞–∑–∏–Ω–µ</a>
                    </div>
                </div>
                <div class="product-card">
                    <img src="https://placehold.co/400x300/e8f5e9/1b5e20?text=‚õ∫" class="product-image">
                    <div class="product-content">
                        <h3 class="product-name">–ì—Ä–æ—É—Ç–µ–Ω—Ç Secret Jardin 120x120</h3>
                        <p class="product-description">–ü—Ä–µ–º–∏—É–º —Ç–µ–Ω—Ç –∏–∑ –ë–µ–ª—å–≥–∏–∏ —Å 95% –æ—Ç—Ä–∞–∂–µ–Ω–∏–µ–º.</p>
                        <div class="product-price">18 990 ‚ÇΩ</div>
                        <a href="https://example.com" target="_blank" class="product-link">üõí –°–º–æ—Ç—Ä–µ—Ç—å –≤ –º–∞–≥–∞–∑–∏–Ω–µ</a>
                    </div>
                </div>
            </div>
        </div>
        <div id="rewardsView" class="view hidden">
            <h2 class="section-title"><span>üéÅ</span> –ù–∞–≥—Ä–∞–¥—ã –∑–∞ –∏–≥—Ä—É</h2>
            <p style="font-size: 13px; color: var(--color-text-secondary); margin-bottom: var(--spacing-md);">
                –û–±–º–µ–Ω–∏–≤–∞–π—Ç–µ üíé –û—á–∫–∏ –ú–∞–≥–∞–∑–∏–Ω–∞ –Ω–∞ –ø—Ä–æ–º–æ–∫–æ–¥—ã!
            </p>
            <div id="rewardsList">
                <div class="reward-card">
                    <h3 class="reward-title"><span>üéÅ</span> –°–∫–∏–¥–∫–∞ 5%</h3>
                    <p class="reward-description">–ü—Ä–æ–º–æ–∫–æ–¥ –Ω–∞ 5% –Ω–∞ –ª—é–±–æ–π –∑–∞–∫–∞–∑</p>
                    <div class="reward-cost">–°—Ç–æ–∏–º–æ—Å—Ç—å: 5000 üíé</div>
                    <button class="redeem-btn" disabled>–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ üíé</button>
                </div>
            </div>
        </div>
        <div id="settingsView" class="view hidden">
            <h2 class="section-title"><span>‚öôÔ∏è</span> –ù–∞—Å—Ç—Ä–æ–π–∫–∏</h2>
            <div class="settings-group">
                <div class="settings-item">
                    <span class="settings-label">–ê–Ω–∏–º–∞—Ü–∏–∏</span>
                    <div class="toggle-switch" id="toggleAnimations">
                        <div class="toggle-slider"></div>
                    </div>
                </div>
                <div class="settings-item">
                    <span class="settings-label">–ó–≤—É–∫–∏</span>
                    <div class="toggle-switch" id="toggleSounds">
                        <div class="toggle-slider"></div>
                    </div>
                </div>
                <div class="settings-item">
                    <span class="settings-label">–í–∏–±—Ä–∞—Ü–∏—è</span>
                    <div class="toggle-switch" id="toggleVibration">
                        <div class="toggle-slider"></div>
                    </div>
                </div>
            </div>
            <div class="settings-group">
                <p style="font-size: 13px; color: var(--color-text-secondary); margin-bottom: var(--spacing-sm);">
                    –í–∞—à —É–Ω–∏–∫–∞–ª—å–Ω—ã–π ID –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏:
                </p>
                <div class="user-id-box" id="userIdDisplay">local-id-12345</div>
            </div>
            <div class="settings-group">
                <button id="resetGameBtn" class="action-btn" style="background: var(--color-error);">–ù–∞—á–∞—Ç—å –∏–≥—Ä—É –∑–∞–Ω–æ–≤–æ</button>
            </div>
        </div>
    </div>
    <div class="bottom-nav glass-ui">
        <button class="nav-item active" data-view="garden">
            <div class="nav-icon">üå±</div>
            <div class="nav-label">–°–∞–¥</div>
        </button>
        <button class="nav-item" data-view="shop">
            <div class="nav-icon">üè™</div>
            <div class="nav-label">–ú–∞–≥–∞–∑–∏–Ω</div>
        </button>
        <button class="nav-item" data-view="inventory">
            <div class="nav-icon">üéí</div>
            <div class="nav-label">–ò–Ω–≤–µ–Ω—Ç–∞—Ä—å</div>
        </button>
        <button class="nav-item" data-view="realShop">
            <div class="nav-icon">üè¨</div>
            <div class="nav-label">–†–µ–∞–ª. –ú–∞–≥.</div>
        </button>
        <button class="nav-item" data-view="rewards">
            <div class="nav-icon">üéÅ</div>
            <div class="nav-label">–ù–∞–≥—Ä–∞–¥—ã</div>
        </button>
        <button class="nav-item" data-view="settings">
            <div class="nav-icon">‚öôÔ∏è</div>
            <div class="nav-label">–ù–∞—Å—Ç—Ä–æ–π–∫–∏</div>
        </button>
    </div>
    <div class="modal" id="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="modalTitle">–ó–∞–≥–æ–ª–æ–≤–æ–∫</h3>
                <button class="modal-close" id="modalClose">√ó</button>
            </div>
            <div class="modal-body" id="modalBody">
                –°–æ–¥–µ—Ä–∂–∏–º–æ–µ
            </div>
            <div class="modal-actions" id="modalActions"></div>
        </div>
    </div>
    <!-- –û–°–ù–û–í–ù–û–ô JS -->
    <script>
        // === –ì–õ–û–ë–ê–õ–¨–ù–´–ï –ü–ï–†–ï–ú–ï–ù–ù–´–ï ===
        let gameState = null;
        let plantElements = {};
        let inventoryElements = {};
        let audioContext;

        // === –ö–û–ù–°–¢–ê–ù–¢–´ (–±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π) ===
        const IMAGE_PATH = "https://placehold.co/100x100/f1f8e9/1b5e20?font=inter&text=";
        const STAGE_IMAGES = {
            seed: `${IMAGE_PATH}üå±`,
            sprout: `${IMAGE_PATH}üåø`,
            vegetative: `${IMAGE_PATH}üå≥`,
            flowering: `${IMAGE_PATH}üå∏`,
            harvest: `${IMAGE_PATH}üåæ`
        };
        const SEED_TYPES = {
            basic: { name: '–ë–∞–∑–æ–≤–∞—è –°–∞—Ç–∏–≤–∞', emoji: 'üå±', image: STAGE_IMAGES.seed, price: 100, yield: 200, level: 1, growthTime: 30000, xp: 10 },
            auto: { name: '–ê–≤—Ç–æ—Ü–≤–µ—Ç', emoji: 'üå∏', image: STAGE_IMAGES.seed, price: 250, yield: 450, level: 3, growthTime: 45000, xp: 20 },
            indica: { name: '–ú–æ—â–Ω–∞—è –ò–Ω–¥–∏–∫–∞', emoji: 'üå≥', image: STAGE_IMAGES.seed, price: 500, yield: 1000, level: 5, growthTime: 60000, xp: 50 },
            legend: { name: '–õ–µ–≥–µ–Ω–¥–∞', emoji: '‚ú®', image: STAGE_IMAGES.seed, price: 1000, yield: 2500, level: 8, growthTime: 90000, xp: 100 }
        };
        const CONSUMABLES = {
            water: { name: '–õ–µ–π–∫–∞', emoji: 'üíß', price: 0, effect: 'water', oneTime: false },
            nitrogen: { name: '–ê–∑–æ—Ç (N)', emoji: 'üß™', price: 50, effect: 'N', oneTime: true, desc: '–î–ª—è —Ä–æ—Å—Ç–∞ (–í–µ–≥–∞)' },
            phosphorus: { name: '–§–æ—Å—Ñ–æ—Ä (P)', emoji: 'üåø', price: 50, effect: 'P', oneTime: true, desc: '–î–ª—è —Ü–≤–µ—Ç–µ–Ω–∏—è (–¶–≤–µ—Ç)' },
            potassium: { name: '–ö–∞–ª–∏–π (K)', emoji: 'üåæ', price: 50, effect: 'K', oneTime: true, desc: '–î–ª—è –∑–¥–æ—Ä–æ–≤—å—è (–û–±—â–µ–µ)' },
            fungicide: { name: '–§—É–Ω–≥–∏—Ü–∏–¥', emoji: 'üçÑ', price: 80, effect: 'fungus', oneTime: true, desc: '–õ–µ—á–∏—Ç –≥—Ä–∏–±–æ–∫' },
            pests: { name: '–û—Ç –≤—Ä–µ–¥–∏—Ç–µ–ª–µ–π', emoji: 'ü¶ó', price: 80, effect: 'pests', oneTime: true, desc: '–£–±–∏–≤–∞–µ—Ç –≤—Ä–µ–¥–∏—Ç–µ–ª–µ–π' },
        };
        const EQUIPMENT = {
            led: { name: 'LED-–ª–∞–º–ø—ã', emoji: 'üí°', price: 500, bonus: '–†–æ—Å—Ç +10%', realProductLink: 'https://example.com' },
            ventilation: { name: '–í–µ–Ω—Ç–∏–ª—è—Ü–∏—è', emoji: 'üåÄ', price: 400, bonus: '–ë–æ–ª–µ–∑–Ω–∏ -10%', realProductLink: 'https://example.com' },
            autowater: { name: '–ê–≤—Ç–æ–ø–æ–ª–∏–≤', emoji: 'üíß', price: 1000, bonus: '–í–æ–¥–∞ x0.5', realProductLink: 'https://example.com' },
        };
        const DISEASES = ['fungus', 'pests'];
        const XP_PER_LEVEL = 100;
        const LEVEL_UNLOCKS = {
            '3': { type: 'slot', count: 3 },
            '5': { type: 'slot', count: 4 },
            '7': { type: 'slot', count: 5 },
            '10': { type: 'slot', count: 6 },
        };

        // === –ü–û–õ–ù–û–°–¢–¨–Æ –ó–ê–ú–ï–ù–Å–ù–ù–ê–Ø –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø –ë–ï–ó FIREBASE ===
        function createInitialGameState() {
            return {
                money: 500,
                shopPoints: 0,
                level: 1,
                xp: 0,
                plants: [null, null],
                inventory: {
                    basic: 2,
                    water: 1,
                    nitrogen: 3,
                    phosphorus: 3,
                    potassium: 3,
                },
                equipment: [],
                settings: {
                    animations: true,
                    sounds: true,
                    vibration: true
                },
                stats: {
                    plantsPlanted: 0,
                    plantsHarvested: 0
                },
                lastSavedAt: Date.now(),
                lastLogin: Date.now(),
            };
        }

        function loadGame() {
            const saved = localStorage.getItem('growbox_save_v51_local');
            if (saved) {
                try {
                    return JSON.parse(saved);
                } catch (e) {
                    console.error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è:", e);
                }
            }
            return createInitialGameState();
        }

        function saveGame() {
            localStorage.setItem('growbox_save_v51_local', JSON.stringify(gameState));
        }

        // === –í–°–ï –§–£–ù–ö–¶–ò–ò –ò–ì–†–´ –ë–ï–ó –ò–ó–ú–ï–ù–ï–ù–ò–ô ===
        function getAudioContext() {
            if (!audioContext) {
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
            }
            return audioContext;
        }
        function playSound(frequency, duration, volume, type = 'sine') {
            if (!gameState.settings.sounds) return;
            try {
                const ctx = getAudioContext();
                const oscillator = ctx.createOscillator();
                const gainNode = ctx.createGain();
                oscillator.connect(gainNode);
                gainNode.connect(ctx.destination);
                oscillator.frequency.value = frequency;
                oscillator.type = type;
                gainNode.gain.setValueAtTime(volume, ctx.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + duration);
                oscillator.start(ctx.currentTime);
                oscillator.stop(ctx.currentTime + duration);
            } catch (e) {
                console.warn('Sound play failed', e);
            }
        }
        function vibrate(pattern) {
            if (gameState.settings.vibration && navigator.vibrate) {
                navigator.vibrate(pattern);
            }
        }
        function showToast(message, type = 'info') {
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.textContent = message;
            document.body.appendChild(toast);
            setTimeout(() => {
                toast.style.animation = 'slideDown 0.3s ease-out reverse';
                setTimeout(() => toast.remove(), 300);
            }, 2500);
        }
        function showModal(title, body, actions) {
            document.getElementById('modalTitle').textContent = title;
            document.getElementById('modalBody').innerHTML = body;
            document.getElementById('modalActions').innerHTML = actions.map(action => 
                `<button class="modal-btn ${action.type}" onclick="${action.onclick}">${action.label}</button>`
            ).join('');
            document.getElementById('modal').classList.add('show');
        }
        function closeModal() {
            document.getElementById('modal').classList.remove('show');
        }
        function getXpNeededForLevel(level) {
            return level * XP_PER_LEVEL;
        }
        function addXP(amount) {
            if (amount <= 0) return;
            gameState.xp += amount;
            let xpNeeded = getXpNeededForLevel(gameState.level);
            while (gameState.xp >= xpNeeded) {
                gameState.level++;
                gameState.xp -= xpNeeded;
                xpNeeded = getXpNeededForLevel(gameState.level);
                showToast(`üéâ –£–†–û–í–ï–ù–¨ –ü–û–í–´–®–ï–ù! –ù–æ–≤—ã–π —É—Ä–æ–≤–µ–Ω—å: ${gameState.level}`, 'success');
                playSound(600, 0.2, 0.3);
                vibrate([100, 50, 100]);
                checkLevelUnlocks();
            }
            updateHeaderUI();
        }
        function checkLevelUnlocks() {
            const unlock = LEVEL_UNLOCKS[gameState.level];
            if (!unlock) return;
            if (unlock.type === 'slot' && gameState.plants.length < unlock.count) {
                gameState.plants.push(null);
                renderGarden();
                showModal('üèÜ –°–ª–æ—Ç –æ—Ç–∫—Ä—ã—Ç!',
                    `–ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º! –í—ã –¥–æ—Å—Ç–∏–≥–ª–∏ ${gameState.level} —É—Ä–æ–≤–Ω—è –∏ –æ—Ç–∫—Ä—ã–ª–∏ –Ω–æ–≤—ã–π —Å–ª–æ—Ç –¥–ª—è —Ä–∞—Å—Ç–µ–Ω–∏—è! –¢–µ–ø–µ—Ä—å —É –≤–∞—Å ${gameState.plants.length} —Å–ª–æ—Ç–∞.`,
                    [{ label: '–û—Ç–ª–∏—á–Ω–æ!', type: 'primary', onclick: 'closeModal()' }]
                );
            }
        }
        window.plantSeed = (slotIndex, seedType) => {
            if (!gameState.inventory[seedType] || gameState.inventory[seedType] <= 0) {
                showToast('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å–µ–º—è–Ω!', 'error');
                return;
            }
            gameState.inventory[seedType]--;
            const seedData = SEED_TYPES[seedType];
            gameState.plants[slotIndex] = {
                type: seedType,
                stage: 'seed',
                health: 100,
                growth: 0,
                plantedAt: Date.now(),
                disease: null,
                soil: { water: 100, N: 100, P: 100, K: 100 }
            };
            gameState.stats.plantsPlanted++;
            addXP(10);
            playSound(400, 0.1, 0.2);
            vibrate(50);
            closeModal();
            renderPlantCard(slotIndex);
            renderInventory();
            updateAdviceBox();
        }
        const GameLogic = {
            getEquipmentBonuses() {
                const bonuses = { growth: 1.0, water: 1.0, disease: 1.0 };
                gameState.equipment.forEach(key => {
                    if (key === 'led') bonuses.growth *= 0.9;
                    if (key === 'autowater') bonuses.water *= 0.5;
                    if (key === 'ventilation') bonuses.disease *= 0.1;
                });
                return bonuses;
            },
            calculateOfflineProgress(lastSavedAt) {
                const offlineTimeSec = Math.floor((Date.now() - lastSavedAt) / 1000);
                if (offlineTimeSec < 60) return;
                const ticks = Math.min(offlineTimeSec, 3600); // –ú–∞–∫—Å 1 —á–∞—Å
                let plantsDied = 0, plantsGrown = 0;
                const bonuses = this.getEquipmentBonuses();
                gameState.plants.forEach(plant => {
                    if (!plant || plant.health <= 0) return;
                    let ticksLeft = ticks;
                    while (ticksLeft > 0 && plant.health > 0) {
                        const seedData = SEED_TYPES[plant.type];
                        plant.soil.water = Math.max(0, plant.soil.water - 0.1 * bonuses.water);
                        if (plant.soil.water <= 0) plant.health = Math.max(0, plant.health - 0.01);
                        if (plant.soil.water > 0) {
                            let growthAmount = 0, N_cost = 0, P_cost = 0, K_cost = 0;
                            const growthPerTick = (1 / (seedData.growthTime / 1000)) * 100 * (1 / bonuses.growth);
                            if (plant.stage === 'vegetative' && plant.soil.N > 0) {
                                growthAmount = growthPerTick; N_cost = 0.05; K_cost = 0.01;
                            } else if (plant.stage === 'flowering' && plant.soil.P > 0 && plant.soil.K > 0) {
                                growthAmount = growthPerTick; P_cost = 0.05; K_cost = 0.05;
                            } else if (plant.stage !== 'harvest') {
                                growthAmount = growthPerTick;
                            }
                            if (growthAmount > 0) {
                                plant.growth = Math.min(100, plant.growth + growthAmount);
                                plant.soil.N = Math.max(0, plant.soil.N - N_cost);
                                plant.soil.P = Math.max(0, plant.soil.P - P_cost);
                                plant.soil.K = Math.max(0, plant.soil.K - K_cost);
                            } else if (plant.health > 0 && plant.stage !== 'harvest') {
                                plant.health = Math.max(0, plant.health - 0.01);
                            }
                            if (plant.growth >= 100 && plant.stage !== 'harvest') {
                                plant.stage = 'harvest'; plantsGrown++;
                            } else if (plant.growth >= 70) plant.stage = 'flowering';
                            else if (plant.growth >= 30) plant.stage = 'vegetative';
                            else if (plant.growth > 0.1) plant.stage = 'sprout';
                        }
                        if (!plant.disease && Math.random() < 0.0001 * bonuses.disease) {
                            plant.disease = DISEASES[Math.floor(Math.random() * DISEASES.length)];
                        }
                        if (plant.disease) plant.health = Math.max(0, plant.health - 0.01);
                        if (plant.health <= 0) plantsDied++;
                        ticksLeft--;
                    }
                });
                showToast(`–ü–æ–∫–∞ –≤–∞—Å –Ω–µ –±—ã–ª–æ: ~${Math.floor(offlineTimeSec / 60)} –º–∏–Ω. –ì–æ—Ç–æ–≤–æ: ${plantsGrown}. –ü–æ–≥–∏–±–ª–æ: ${plantsDied}.`, 'info');
            },
            applyItem(slotIndex, itemId) {
                const plant = gameState.plants[slotIndex];
                const item = CONSUMABLES[itemId];
                if (!plant || plant.health <= 0 || !item) return;
                let applied = false;
                switch (item.effect) {
                    case 'water': plant.soil.water = 100; applied = true; addXP(1); break;
                    case 'N': plant.soil.N = 100; applied = true; addXP(5); break;
                    case 'P': plant.soil.P = 100; applied = true; addXP(5); break;
                    case 'K': plant.soil.K = 100; applied = true; addXP(5); break;
                    case 'fungus': if (plant.disease === 'fungus') { plant.disease = null; applied = true; addXP(20); } break;
                    case 'pests': if (plant.disease === 'pests') { plant.disease = null; applied = true; addXP(20); } break;
                }
                if (applied) {
                    if (item.oneTime) gameState.inventory[itemId]--;
                    updatePlantCardUI(slotIndex, plant);
                    renderInventory();
                    updateAdviceBox();
                    playSound(300, 0.1, 0.2);
                    vibrate(50);
                    saveGame();
                } else {
                    showToast('–ù–µ–ª—å–∑—è –ø—Ä–∏–º–µ–Ω–∏—Ç—å —Å–µ–π—á–∞—Å', 'info');
                }
            }
        };
        function updateHeaderUI() {
            document.getElementById('moneyDisplay').textContent = gameState.money;
            document.getElementById('shopPointsDisplay').textContent = gameState.shopPoints;
            document.getElementById('levelDisplay').textContent = gameState.level;
            const xpNeeded = getXpNeededForLevel(gameState.level);
            const xpPercent = Math.min(100, (gameState.xp / xpNeeded) * 100);
            document.getElementById('xpBarFill').style.width = `${xpPercent}%`;
            document.getElementById('xpBarText').textContent = `${gameState.xp} / ${xpNeeded} XP`;
            document.getElementById('bonus-led').style.display = gameState.equipment.includes('led') ? 'block' : 'none';
            document.getElementById('bonus-ventilation').style.display = gameState.equipment.includes('ventilation') ? 'block' : 'none';
            document.getElementById('bonus-autowater').style.display = gameState.equipment.includes('autowater') ? 'block' : 'none';
        }
        function renderGarden() {
            const grid = document.getElementById('gardenGrid');
            grid.innerHTML = '';
            plantElements = {};
            gameState.plants.forEach((plant, index) => {
                const slot = document.createElement('div');
                grid.appendChild(slot);
                renderPlantCard(index, slot);
            });
        }
        function renderPlantCard(slotIndex, slotElement) {
            const plant = gameState.plants[slotIndex];
            if (!slotElement) {
                slotElement = document.getElementById(`plant-slot-${slotIndex}`);
                if (!slotElement) {
                    slotElement = document.createElement('div');
                    document.getElementById('gardenGrid').appendChild(slotElement);
                }
            }
            slotElement.id = `plant-slot-${slotIndex}`;
            if (plant) {
                const seedData = SEED_TYPES[plant.type];
                slotElement.className = 'plant-card glass-ui';
                slotElement.innerHTML = `
                    <div class="plant-header">
                        <span class="plant-name">${seedData.name}</span>
                        <span class="plant-stage" id="stage-${slotIndex}">${getStageText(plant.stage)}</span>
                    </div>
                    <div class="plant-image-container">
                        <img src="${STAGE_IMAGES[plant.stage]}" class="plant-image" id="image-${slotIndex}" alt="${plant.stage}">
                    </div>
                    <div class="plant-stats">
                        <div class="stat-bar">
                            <span class="stat-icon">‚ù§Ô∏è</span>
                            <div class="progress-bar"><div class="progress-fill" id="health-${slotIndex}" style="width: ${plant.health}%; background: var(--color-success);"></div></div>
                        </div>
                        <div class="stat-bar">
                            <span class="stat-icon">üìà</span>
                            <div class="progress-bar"><div class="progress-fill" id="growth-${slotIndex}" style="width: ${plant.growth}%; background: var(--color-warning);"></div></div>
                        </div>
                        <div class="stat-bar">
                            <span class="stat-icon">üíß</span>
                            <div class="progress-bar"><div class="progress-fill" id="water-${slotIndex}" style="width: ${plant.soil.water}%; background: var(--color-info);"></div></div>
                        </div>
                    </div>
                    <div class="soil-stats">
                        <div class="soil-stat"><span class="soil-stat-label">N:</span> <span id="N-${slotIndex}">${Math.round(plant.soil.N)}</span>%</div>
                        <div class="soil-stat"><span class="soil-stat-label">P:</span> <span id="P-${slotIndex}">${Math.round(plant.soil.P)}</span>%</div>
                        <div class="soil-stat"><span class="soil-stat-label">K:</span> <span id="K-${slotIndex}">${Math.round(plant.soil.K)}</span>%</div>
                    </div>
                    <div class="plant-actions" id="actions-${slotIndex}"></div>
                    ${plant.disease ? `<div class="disease-badge">${plant.disease}</div>` : ''}
                `;
                updatePlantAction(slotIndex, plant);
                if (plant.health > 0) {
                    slotElement.classList.add('droppable');
                    slotElement.dataset.slotIndex = slotIndex;
                }
                slotElement.classList.toggle('harvestable', plant.stage === 'harvest');
                slotElement.classList.toggle('sick', !!plant.disease);
            } else {
                slotElement.className = 'plant-card empty';
                slotElement.innerHTML = `
                    <div style="text-align: center;">
                        <div style="font-size: 48px; margin-bottom: 8px;">‚ûï</div>
                        <div style="font-size: 14px; color: var(--color-primary);">–°–≤–æ–±–æ–¥–Ω—ã–π —Å–ª–æ—Ç</div>
                    </div>
                `;
                slotElement.onclick = () => openPlantModal(slotIndex);
                slotElement.classList.remove('droppable', 'harvestable', 'sick');
            }
            plantElements[slotIndex] = {
                slot: slotElement,
                health: document.getElementById(`health-${slotIndex}`),
                water: document.getElementById(`water-${slotIndex}`),
                growth: document.getElementById(`growth-${slotIndex}`),
                stage: document.getElementById(`stage-${slotIndex}`),
                image: document.getElementById(`image-${slotIndex}`),
                N: document.getElementById(`N-${slotIndex}`),
                P: document.getElementById(`P-${slotIndex}`),
                K: document.getElementById(`K-${slotIndex}`),
                actions: document.getElementById(`actions-${slotIndex}`),
            };
        }
        function updatePlantCardUI(slotIndex, plant) {
            const els = plantElements[slotIndex];
            if (!els || !plant) return;
            els.health.style.width = plant.health + '%';
            els.health.style.background = plant.health < 30 ? 'var(--color-error)' : 'var(--color-success)';
            els.water.style.width = plant.soil.water + '%';
            els.growth.style.width = plant.growth + '%';
            els.stage.textContent = getStageText(plant.stage);
            els.image.src = STAGE_IMAGES[plant.stage]; 
            els.N.textContent = Math.round(plant.soil.N) + '%';
            els.P.textContent = Math.round(plant.soil.P) + '%';
            els.K.textContent = Math.round(plant.soil.K) + '%';
            updatePlantAction(slotIndex, plant);
            els.slot.classList.toggle('harvestable', plant.stage === 'harvest');
            els.slot.classList.toggle('sick', !!plant.disease);
        }
        function updatePlantAction(slotIndex, plant) {
            const els = plantElements[slotIndex];
            if (!els || !els.actions) return;
            els.actions.innerHTML = '';
            if (plant.stage === 'harvest') {
                els.actions.innerHTML = `<button class="action-btn harvest" onclick="harvestPlant(${slotIndex})">üåæ –°–æ–±—Ä–∞—Ç—å —É—Ä–æ–∂–∞–π</button>`;
            } else if (plant.health <= 0) {
                els.actions.innerHTML = `<button class="action-btn" onclick="removePlant(${slotIndex})" style="background: var(--color-error);">üóëÔ∏è –£–±—Ä–∞—Ç—å</button>`;
            }
        }
        function renderInventory() {
            const grid = document.getElementById('inventoryGrid');
            grid.innerHTML = '';
            inventoryElements = {};
            for (const key in gameState.inventory) {
                const count = gameState.inventory[key];
                if (count <= 0) continue;
                const item = CONSUMABLES[key] || SEED_TYPES[key];
                if (!item) continue;
                const card = document.createElement('div');
                card.className = 'item-card inventory-card glass-ui';
                card.innerHTML = `
                    <div class="inventory-count" id="count-${key}">${count}x</div>
                    <div class="item-icon">${item.emoji}</div>
                    <div class="inventory-name">${item.name}</div>
                `;
                if (CONSUMABLES[key]) {
                    card.classList.add('draggable');
                    card.dataset.itemId = key;
                } else {
                    card.style.cursor = 'not-allowed';
                }
                grid.appendChild(card);
                inventoryElements[key] = { card: card, count: document.getElementById(`count-${key}`) };
            }
        }
        function renderShops() {
            const seedsGrid = document.getElementById('seedsShop');
            seedsGrid.innerHTML = Object.entries(SEED_TYPES).map(([key, item]) => {
                const locked = item.level > gameState.level;
                return `
                <div class="item-card glass-ui">
                    <div class="item-icon"><img src="${item.image}" alt="${item.name}" style="width: 60px; height: 60px; border-radius: 8px;"></div>
                    <div class="item-name">${item.name}</div>
                    <div class="item-description">–£—Ä–æ–∂–∞–π: ${item.yield} / XP: ${item.xp}</div>
                    <div class="item-price">${locked ? `LVL ${item.level}` : `${item.price} üí∞`}</div>
                    <button class="buy-btn" onclick="buyItem('${key}', 'seed')" ${locked ? 'disabled' : ''}>
                        ${locked ? 'üîí' : '–ö—É–ø–∏—Ç—å'}
                    </button>
                </div>`;
            }).join('');
            const consumablesGrid = document.getElementById('consumablesShop');
            consumablesGrid.innerHTML = Object.entries(CONSUMABLES).filter(([key]) => key !== 'water').map(([key, item]) => `
                <div class="item-card glass-ui">
                    <div class="item-icon">${item.emoji}</div>
                    <div class="item-name">${item.name}</div>
                    <div class="item-description">${item.desc}</div>
                    <div class="item-price">${item.price} üí∞</div>
                    <button class="buy-btn" onclick="buyItem('${key}', 'consumable')">–ö—É–ø–∏—Ç—å</button>
                </div>`).join('');
            const equipmentGrid = document.getElementById('equipmentShop');
            equipmentGrid.innerHTML = Object.entries(EQUIPMENT).map(([key, item]) => {
                const owned = gameState.equipment.includes(key);
                return `
                <div class="item-card glass-ui">
                    <div class="item-icon">${item.emoji}</div>
                    <div class="item-name">${item.name}</div>
                    <div class="item-description">${item.bonus}</div>
                    <div class="item-price">${item.price} üí∞</div>
                    <button class="buy-btn" onclick="buyItem('${key}', 'equipment')" ${owned ? 'disabled' : ''}>
                        ${owned ? '‚úÖ –ö—É–ø–ª–µ–Ω–æ' : '–ö—É–ø–∏—Ç—å'}
                    </button>
                </div>`;
            }).join('');
        }
        function renderRewards() {
            const list = document.getElementById('rewardsList');
            list.innerHTML = `
                <div class="reward-card">
                    <h3 class="reward-title"><span>üéÅ</span> –°–∫–∏–¥–∫–∞ 5%</h3>
                    <p class="reward-description">–ü—Ä–æ–º–æ–∫–æ–¥ –Ω–∞ 5% –Ω–∞ –ª—é–±–æ–π –∑–∞–∫–∞–∑</p>
                    <div class="reward-cost">–°—Ç–æ–∏–º–æ—Å—Ç—å: 5000 üíé</div>
                    <button class="redeem-btn" ${gameState.shopPoints >= 5000 ? '' : 'disabled'}>
                        ${gameState.shopPoints >= 5000 ? '–ü–æ–ª—É—á–∏—Ç—å' : '–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ üíé'}
                    </button>
                </div>
            `;
        }
        function renderSettings() {
            const animToggle = document.getElementById('toggleAnimations');
            const soundsToggle = document.getElementById('toggleSounds');
            const vibroToggle = document.getElementById('toggleVibration');
            if (gameState.settings.animations) animToggle.classList.add('active');
            if (gameState.settings.sounds) soundsToggle.classList.add('active');
            if (gameState.settings.vibration) vibroToggle.classList.add('active');
            animToggle.onclick = () => {
                gameState.settings.animations = !gameState.settings.animations;
                animToggle.classList.toggle('active');
                updateTime();
            };
            soundsToggle.onclick = () => {
                gameState.settings.sounds = !gameState.settings.sounds;
                soundsToggle.classList.toggle('active');
            };
            vibroToggle.onclick = () => {
                gameState.settings.vibration = !gameState.settings.vibration;
                vibroToggle.classList.toggle('active');
            };
            document.getElementById('resetGameBtn').onclick = () => {
                showModal('–ù–∞—á–∞—Ç—å –∑–∞–Ω–æ–≤–æ?', 
                    '–í–µ—Å—å –≤–∞—à –ø—Ä–æ–≥—Ä–µ—Å—Å –±—É–¥–µ—Ç –Ω–µ–æ–±—Ä–∞—Ç–∏–º–æ —É–¥–∞–ª–µ–Ω. –í—ã —É–≤–µ—Ä–µ–Ω—ã?',
                    [
                        { label: '–û—Ç–º–µ–Ω–∞', type: 'secondary', onclick: 'closeModal()' },
                        { label: '–î–∞, —É–¥–∞–ª–∏—Ç—å', type: 'primary', onclick: 'resetGame()' }
                    ]
                );
            };
        }
        function updateAdviceBox() {
            const adviceBox = document.getElementById('adviceBox');
            let advices = [];
            gameState.plants.forEach((plant, i) => {
                if (!plant || plant.health <= 0) return;
                if (plant.disease) advices.push(`–†–∞—Å—Ç–µ–Ω–∏–µ #${i+1} –±–æ–ª–µ–µ—Ç (${plant.disease})!`);
                if (plant.soil.water < 20) advices.push(`–†–∞—Å—Ç–µ–Ω–∏–µ #${i+1} —Ö–æ—á–µ—Ç –ø–∏—Ç—å!`);
                if (plant.stage === 'vegetative' && plant.soil.N < 10) advices.push(`–†–∞—Å—Ç–µ–Ω–∏—é #${i+1} –Ω–µ —Ö–≤–∞—Ç–∞–µ—Ç –ê–∑–æ—Ç–∞ (N)!`);
                if (plant.stage === 'flowering' && (plant.soil.P < 10 || plant.soil.K < 10)) advices.push(`–†–∞—Å—Ç–µ–Ω–∏—é #${i+1} –Ω–µ —Ö–≤–∞—Ç–∞–µ—Ç P –∏–ª–∏ K!`);
                if (plant.stage === 'harvest') advices.push(`–†–∞—Å—Ç–µ–Ω–∏–µ #${i+1} –≥–æ—Ç–æ–≤–æ –∫ —Å–±–æ—Ä—É!`);
            });
            if (advices.length > 0) {
                adviceBox.textContent = `üí° ${advices[0]}`;
                adviceBox.style.borderColor = 'var(--color-warning)';
            } else {
                adviceBox.textContent = '‚úÖ –í—Å–µ —Ä–∞—Å—Ç–µ–Ω–∏—è –≤ –ø–æ—Ä—è–¥–∫–µ. –û—Ç–ª–∏—á–Ω–∞—è —Ä–∞–±–æ—Ç–∞!';
                adviceBox.style.borderColor = 'var(--color-primary)';
            }
        }
        window.buyItem = (key, type) => {
            let item, price, isOwned = false;
            if (type === 'seed') {
                item = SEED_TYPES[key];
                price = item.price;
                if (item.level > gameState.level) {
                    showToast(`–¢—Ä–µ–±—É–µ—Ç—Å—è ${item.level} —É—Ä–æ–≤–µ–Ω—å!`, 'error'); return;
                }
            } else if (type === 'consumable') {
                item = CONSUMABLES[key];
                price = item.price;
            } else if (type === 'equipment') {
                item = EQUIPMENT[key];
                price = item.price;
                isOwned = gameState.equipment.includes(key);
                if (isOwned) { showToast('–£–∂–µ –∫—É–ø–ª–µ–Ω–æ!', 'info'); return; }
            }
            if (gameState.money < price) {
                showToast('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ üí∞!', 'error'); return;
            }
            gameState.money -= price;
            if (type === 'equipment') {
                gameState.equipment.push(key);
                showModal('‚öôÔ∏è –û–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ!',
                    `–í—ã –∫—É–ø–∏–ª–∏ "${item.name}"! ${item.bonus}.`,
                    [
                        { label: '–ó–∞–∫—Ä—ã—Ç—å', type: 'secondary', onclick: 'closeModal()' },
                        { label: 'üè¨ –í –º–∞–≥–∞–∑–∏–Ω!', type: 'primary', onclick: `window.open('${item.realProductLink}', '_blank'); closeModal();` }
                    ]
                );
            } else {
                gameState.inventory[key] = (gameState.inventory[key] || 0) + 1;
            }
            addXP(Math.floor(price / 10));
            playSound(500, 0.1, 0.2);
            vibrate(50);
            updateHeaderUI();
            renderInventory();
            renderShops();
        }
        window.harvestPlant = (slotIndex) => {
            const plant = gameState.plants[slotIndex];
            if (!plant || plant.stage !== 'harvest') return;
            const seedData = SEED_TYPES[plant.type];
            const plantYield = seedData.yield;
            const shopPoints = Math.floor(plantYield / 20);
            gameState.money += plantYield;
            gameState.shopPoints += shopPoints;
            gameState.stats.plantsHarvested++;
            addXP(seedData.xp);
            showToast(`üåæ –°–æ–±—Ä–∞–Ω–æ! +${plantYield} üí∞ –∏ +${shopPoints} üíé`, 'success');
            playSound(700, 0.2, 0.3);
            vibrate([50, 100, 50]);
            showConfetti();
            gameState.plants[slotIndex] = null;
            renderPlantCard(slotIndex);
            updateHeaderUI();
            updateAdviceBox();
        }
        window.removePlant = (slotIndex) => {
            gameState.plants[slotIndex] = null;
            renderPlantCard(slotIndex);
            updateAdviceBox();
        }
        window.redeemReward = (rewardId) => {
            if (gameState.shopPoints < 5000) {
                showToast('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ üíé!', 'error'); return;
            }
            gameState.shopPoints -= 5000;
            showModal('üéÅ –í–∞—à–∞ –Ω–∞–≥—Ä–∞–¥–∞!',
                `–í–∞—à –ø—Ä–æ–º–æ–∫–æ–¥: <strong>GB5_${Math.random().toString(36).substr(2, 6).toUpperCase()}</strong>`,
                [{ label: '–û—Ç–ª–∏—á–Ω–æ!', type: 'primary', onclick: 'closeModal()' }]
            );
            updateHeaderUI();
        }
        window.resetGame = () => {
            closeModal();
            gameState = createInitialGameState();
            saveGame();
            updateHeaderUI();
            renderGarden();
            renderInventory();
            renderShops();
            renderRewards();
            updateAdviceBox();
            showToast('–ò–≥—Ä–∞ –Ω–∞—á–∞—Ç–∞ –∑–∞–Ω–æ–≤–æ!', 'info');
        }
        function openPlantModal(slotIndex) {
            const availableSeeds = Object.entries(SEED_TYPES).filter(([key, seed]) => {
                return seed.level <= gameState.level && (gameState.inventory[key] || 0) > 0;
            });
            if (availableSeeds.length === 0) {
                showToast('–£ –≤–∞—Å –Ω–µ—Ç —Å–µ–º—è–Ω! –ö—É–ø–∏—Ç–µ –∏—Ö –≤ –º–∞–≥–∞–∑–∏–Ω–µ.', 'error');
                return;
            }
            const modalBody = '<div class="item-grid">' + availableSeeds.map(([key, seed]) => `
                <div class="item-card" style="cursor: pointer;" onclick="plantSeed(${slotIndex}, '${key}')">
                    <div class="item-icon"><img src="${seed.image}" alt="${seed.name}" style="width: 60px; height: 60px; border-radius: 8px;"></div>
                    <div class="item-name">${seed.name}</div>
                    <div class="item-description">–í –Ω–∞–ª–∏—á–∏–∏: ${gameState.inventory[key] || 0}</div>
                </div>
            `).join('') + '</div>';
            showModal('üå± –í—ã–±–µ—Ä–∏—Ç–µ —Å–µ–º–µ–Ω–∞', modalBody, []);
        }
        function getStageText(stage) {
            return {
                seed: '–°–µ–º—è', sprout: '–†–æ—Å—Ç–æ–∫', vegetative: '–í–µ–≥–µ—Ç–∞—Ü–∏—è',
                flowering: '–¶–≤–µ—Ç–µ–Ω–∏–µ', harvest: '–£—Ä–æ–∂–∞–π'
            }[stage];
        }
        function gameTick() {
            let changed = false;
            const bonuses = GameLogic.getEquipmentBonuses();
            gameState.plants.forEach((plant, index) => {
                if (!plant || plant.health <= 0) return;
                const seedData = SEED_TYPES[plant.type];
                plant.soil.water = Math.max(0, plant.soil.water - 0.1 * bonuses.water);
                if (plant.soil.water <= 0) plant.health = Math.max(0, plant.health - 0.01);
                if (plant.soil.water > 0) {
                    let growthAmount = 0, N_cost = 0, P_cost = 0, K_cost = 0;
                    const growthPerTick = (1 / (seedData.growthTime / 1000)) * 100 * (1 / bonuses.growth);
                    if (plant.stage === 'vegetative' && plant.soil.N > 0) {
                        growthAmount = growthPerTick; N_cost = 0.05; K_cost = 0.01;
                    } else if (plant.stage === 'flowering' && plant.soil.P > 0 && plant.soil.K > 0) {
                        growthAmount = growthPerTick; P_cost = 0.05; K_cost = 0.05;
                    } else if (plant.stage !== 'harvest') {
                        growthAmount = growthPerTick;
                    }
                    if (growthAmount > 0) {
                        plant.growth = Math.min(100, plant.growth + growthAmount);
                        plant.soil.N = Math.max(0, plant.soil.N - N_cost);
                        plant.soil.P = Math.max(0, plant.soil.P - P_cost);
                        plant.soil.K = Math.max(0, plant.soil.K - K_cost);
                    } else if (plant.health > 0 && plant.stage !== 'harvest') {
                        plant.health = Math.max(0, plant.health - 0.01);
                    }
                    let oldStage = plant.stage;
                    if (plant.growth >= 100) plant.stage = 'harvest';
                    else if (plant.growth >= 70) plant.stage = 'flowering';
                    else if (plant.growth >= 30) plant.stage = 'vegetative';
                    else if (plant.growth > 0.1) plant.stage = 'sprout';
                    if (oldStage !== plant.stage) changed = true;
                }
                if (!plant.disease && Math.random() < 0.0001 * bonuses.disease) {
                    plant.disease = DISEASES[Math.floor(Math.random() * DISEASES.length)];
                    changed = true;
                }
                if (plant.disease) plant.health = Math.max(0, plant.health - 0.01);
                if (plant.health <= 0) changed = true;
                updatePlantCardUI(index, plant);
            });
            if (changed) updateAdviceBox();
        }
        function updateTime() {
            const hour = new Date().getHours();
            const isDay = hour >= 6 && hour < 20;
            const stars = document.getElementById('stars');
            if (gameState.settings.animations) {
                stars.style.display = 'block';
                stars.style.opacity = isDay ? 0 : 1;
            } else {
                stars.style.display = 'none';
            }
        }
        function generateStars() {
            const stars = document.getElementById('stars');
            stars.innerHTML = '';
            for (let i = 0; i < 50; i++) {
                const star = document.createElement('div');
                star.className = 'star';
                star.style.left = Math.random() * 100 + '%';
                star.style.top = Math.random() * 100 + '%';
                star.style.animationDelay = Math.random() * 2 + 's';
                stars.appendChild(star);
            }
        }
        function showConfetti() {
            if (!gameState.settings.animations) return;
            for (let i = 0; i < 30; i++) {
                const confetti = document.createElement('div');
                confetti.style.cssText = `position: fixed; top: -10px; left: ${Math.random()*100}%; width: 10px; height: 10px; background: var(--color-gold); opacity: 1; z-index: 9999;`;
                confetti.style.animation = `confetti-fall ${Math.random()*2+3}s ${Math.random()*1}s linear forwards`;
                document.body.appendChild(confetti);
            }
        }
        const styleSheet = document.createElement("style");
        styleSheet.type = "text/css";
        styleSheet.innerText = `@keyframes confetti-fall { to { transform: translateY(100vh) rotate(720deg); opacity: 0; } }`;
        document.head.appendChild(styleSheet);
        function setupNavigation() {
            const navItems = document.querySelectorAll('.nav-item');
            const views = document.querySelectorAll('.view');
            navItems.forEach(item => {
                item.addEventListener('click', () => {
                    const viewName = item.dataset.view;
                    views.forEach(v => v.classList.add('hidden'));
                    const targetView = document.getElementById(`${viewName}View`);
                    if (targetView) targetView.classList.remove('hidden');
                    navItems.forEach(n => n.classList.remove('active'));
                    item.classList.add('active');
                    if (viewName === 'shop' && document.getElementById('seedsShop').innerHTML === '') renderShops();
                    if (viewName === 'inventory' && document.getElementById('inventoryGrid').innerHTML === '') renderInventory();
                    if (viewName === 'rewards' && document.getElementById('rewardsList').innerHTML === '') renderRewards();
                    if (viewName === 'settings' && !document.getElementById('toggleAnimations').onclick) renderSettings();
                    playSound(800, 0.05, 0.1);
                });
            });
        }
        function setupDragAndDrop() {
            let draggingItem = null;
            document.addEventListener('dragstart', (e) => {
                if (e.target.classList.contains('draggable')) {
                    draggingItem = e.target;
                    e.dataTransfer.setData('text/plain', e.target.dataset.itemId);
                    setTimeout(() => e.target.classList.add('dragging'), 0);
                    vibrate(50);
                }
            });
            document.addEventListener('dragend', (e) => {
                if (draggingItem) {
                    draggingItem.classList.remove('dragging');
                    draggingItem = null;
                }
            });
            document.addEventListener('dragover', (e) => {
                e.preventDefault();
                const dropTarget = e.target.closest('.droppable');
                if (dropTarget) dropTarget.classList.add('droppable-hover');
            });
            document.addEventListener('dragleave', (e) => {
                const dropTarget = e.target.closest('.droppable');
                if (dropTarget) dropTarget.classList.remove('droppable-hover');
            });
            document.addEventListener('drop', (e) => {
                e.preventDefault();
                const dropTarget = e.target.closest('.droppable');
                if (dropTarget && draggingItem) {
                    dropTarget.classList.remove('droppable-hover');
                    const slotIndex = dropTarget.dataset.slotIndex;
                    const itemId = draggingItem.dataset.itemId;
                    GameLogic.applyItem(slotIndex, itemId);
                }
            });
        }
        // === –ì–õ–ê–í–ù–ê–Ø –§–£–ù–ö–¶–ò–Ø –ó–ê–ü–£–°–ö–ê ===
        async function bootApplication() {
            gameState = loadGame();
            // –û—Ñ—Ñ–ª–∞–π–Ω –ø—Ä–æ–≥—Ä–µ—Å—Å
            if (gameState.lastSavedAt) {
                GameLogic.calculateOfflineProgress(gameState.lastSavedAt);
            }
            gameState.lastLogin = Date.now();
            // UI
            setupNavigation();
            setupDragAndDrop();
            document.getElementById('modalClose').onclick = closeModal;
            document.getElementById('userIdDisplay').textContent = 'local-id-' + Math.floor(Math.random() * 100000);
            // –†–µ–Ω–¥–µ—Ä
            updateHeaderUI();
            renderGarden();
            updateAdviceBox();
            updateTime();
            generateStars();
            // –¶–∏–∫–ª—ã
            setInterval(gameTick, 1000);
            setInterval(() => { saveGame(); gameState.lastSavedAt = Date.now(); }, 30000);
            setInterval(updateTime, 60000);
            // –ì–æ—Ç–æ–≤–æ
            document.getElementById('loadingOverlay').style.display = 'none';
        }
        // === –ó–ê–ü–£–°–ö ===
        document.addEventListener('DOMContentLoaded', () => {
            bootApplication();
        });
    </script>
</body>
</html>
